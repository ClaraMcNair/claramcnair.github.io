"use client";

import gsap from "gsap";
import { ScrollTrigger, MorphSVGPlugin } from "gsap/all";
import { useGSAP } from '@gsap/react';


gsap.registerPlugin(useGSAP, MorphSVGPlugin, ScrollTrigger);


export default function IconAnimation() {

  useGSAP(() => {

    const VELOCITY_TO_ENERGY = 3500; // bigger => less sensitive
    const DECAY = 0.85;              // 0.85â€“0.95 (higher => slower decay)

    let energy = 0;
    
    const tween = gsap.to("#square", {
      rotate: 45,
      transformOrigin: "center center",
      morphSVG: "#star",
      duration: 2,
      ease: "sine.inOut",
      paused: true
      //ease: "expo.inOut",
      //repeat: -1,
      //yoyo: true
    });

    const trigger = ScrollTrigger.create({
      start: 0,
      end: "max",
      onUpdate(self) {
        const speed = Math.abs(self.getVelocity()); // px/sec
        const impulse = gsap.utils.clamp(0, 2, speed / VELOCITY_TO_ENERGY);
        energy = Math.max(energy, impulse); // take peaks, then decay
      },
    });

    const tick = () => {
      energy *= DECAY;
      // avoid tiny perpetual updates
      if (energy < 0.0005) energy = 0;
      tween.progress(energy);
    };

    gsap.ticker.add(tick);




  })



  return (
    <div className="size-20 sticky bottom-0 float-right">
      
      <svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 500">
            <path id="square" className="fill-accent-secondary" d="M303.29,400h-106.57c-53.19,0-96.71-43.52-96.71-96.71v-106.57c0-53.19,43.52-96.71,96.71-96.71h106.57c53.19,0,96.71,43.52,96.71,96.71v106.57c0,53.19-43.52,96.71-96.71,96.71Z" />
            <path id="star" fill="transparent" d="M198.5,226.53c-5.77,2.43-7.74,3.75-11.15,3.43-3.92-.36-6.59-2.59-7.72-3.43-6-4.45-14.41-3.74-34.32-2.57-40,2.34-37.4,1.3-42.89,2.57-6.05,1.4-14.41,3.88-26.59,4.29-4.48.15-7.21.24-11.15,0-6.64-.41-15.41-1.68-23.16,0-1.36.29-3.59.87-4.29,2.57-.71,1.71.49,3.68.86,4.29,2.61,4.31,8.13,5.17,13.73,6.86,7.93,2.4,7.42,3.88,15.44,6.86,6.42,2.39,9.95,2.64,34.32,5.15,13.38,1.38,20.11,2.08,22.31,2.57,9.38,2.11,8.99,3.45,27.45,9.44,5.69,1.85,5.84,1.76,22.31,6.86,10.84,3.36,11.4,2.92,13.73,4.29,9.84,5.76,13.49,16.54,15.44,22.31,1.37,4.05,3.89,11.76,2.57,21.45-.83,6.11-3.41,11.22-8.58,21.45-.84,1.66-4,7.13-10.29,18.02-7.2,12.45-10.86,18.71-13.73,20.59-2.97,1.95-6.58,3.35-9.44,7.72-1.97,3.02-1.48,4.23-3.43,6.86-1.68,2.26-3.48,3.32-11.15,6.86-4.88,2.26-9.67,4.68-14.58,6.86-4.7,2.09-7.32,3.15-8.58,6.01-.14.32-1.47,3.46,0,6.01,1.61,2.79,5.56,3.11,10.29,3.43,3.35.23,6.82.43,12.01-.86,8.09-2.01,8.7-4.75,18.87-9.44,10.31-4.75,11.33-2.7,17.16-6.86,5.67-4.05,5.82-6.78,12.01-10.29,4.45-2.52,6.09-2.09,12.01-4.29,9.18-3.41,15.41-8.25,18.02-10.29,8.01-6.31,12.59-12.95,15.44-17.16,4.44-6.55,3.46-7,9.44-17.16,10.38-17.63,15.1-19.25,17.16-19.73,5.55-1.31,10.71,1.11,12.01,1.72,3.65,1.71,4.26,3.36,10.29,9.44,6.82,6.87,10.24,10.31,15.44,12.87,5.71,2.81,6.88,1.39,11.15,4.29,1.43.97,3.61,2.7,9.44,12.01,3.63,5.81,4.52,7.91,10.29,18.02,2.44,4.27,3.86,6.76,6.01,10.29,6.13,10.12,6.23,9.12,8.58,13.73,3.46,6.79,3.28,9.04,6.86,12.87,2.03,2.17,2.05,1.41,6.01,5.15,3.94,3.73,5.27,5.77,8.58,6.86,1.14.38,3.5,1.16,5.15,0,1.59-1.12,1.72-3.51,1.72-5.15-.04-7.8-3.32-14.98-4.29-17.16-2.57-5.79-3.94-12.03-6.01-18.02-5.32-15.45-4.36-14.57-8.58-26.59-1.28-3.66-4.29-11.31-10.29-26.59-5.46-13.88-6.16-15.43-7.72-18.02-3.21-5.31-8.57-12.53-12.01-17.16-3.84-5.17-5-6.49-6.01-9.44-2.22-6.49-.77-12.43,0-15.44,2.17-8.46,7.09-13.69,11.15-18.02,3.51-3.73,7.36-7.83,13.73-10.29,4.85-1.88,6.31-.92,11.15-2.57,6.09-2.08,9.27-5.46,14.58-10.29,11.86-10.8,10.79-7.39,22.31-18.02,3.52-3.25,10.43-9.84,18.02-18.87,4.86-5.78,7.56-9.67,8.58-11.15,3.6-5.27,2.33-4.27,7.72-12.87,3.61-5.76,5.12-7.7,5.15-11.15.01-1.11.04-4.85-2.57-6.86-2.44-1.87-5.71-1.12-6.86-.86-4.42,1.01-6.2,3.92-10.29,7.72-4.42,4.11-4.62,2.84-13.73,9.44-8.4,6.08-7.36,6.54-12.87,10.29-5.37,3.66-10.8,5.92-21.45,10.29-8.18,3.36-12.27,5.04-18.02,6.86-19.86,6.31-20.41,2.21-34.32,7.72-3.6,1.43-7.59,3.29-12.87,2.57-1.47-.2-7.45-1.2-11.15-6.01-2.25-2.91-1.68-4.67-3.43-12.01-2.24-9.36-3.79-9.16-5.15-16.3-1.38-7.25.29-7.16-.86-15.44-1.19-8.63-3.18-10.04-4.29-18.02-.35-2.48-.35-3.75,0-15.44.79-26.64,1.07-29.15,1.72-32.6,1.23-6.65,2.16-7.98,2.57-13.73.58-8.09-1.14-7.05-.86-17.16.08-2.9.3-6-1.72-8.58-.32-.41-1.96-2.5-4.29-2.57-2.62-.08-4.66,2.43-6.01,4.29-6.07,8.39-8.58,18.02-8.58,18.02-.44,1.7.6-2.5-10.29,24.88-7.25,18.21-10.91,27.46-12.87,34.32-1.41,4.92-3.5,12.35-5.15,22.31-.58,3.53-.44,3.32-2.57,18.02-1.06,7.31-1.76,11.93-3.43,18.02-1.49,5.4-2.27,8.17-4.29,11.15-3.43,5.07-7.93,7.64-11.15,9.44-4.75,2.65-4.41,1.23-13.73,5.15Z"/>
          </svg>
    </div>
  )
}